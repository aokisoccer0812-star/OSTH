ASREProast（AS-REP Roasting）とは、Kerberos認証システムにおける攻撃の一種で、特にActive Directory環境で使われる技術です。この攻撃は、**Kerberos認証の認証レスポンス（AS-REP）**を利用して、パスワードのハッシュ（または平文）を回収することを目的としています。

AS-REP Roasting の概要

Kerberos認証とAS-REP:

Kerberosは、ネットワーク上でユーザー認証を行うためのプロトコルで、特にWindows環境（Active Directory）で広く使用されています。

Kerberosでは、認証サーバー（KDC）がクライアントにチケットを発行し、クライアントはそのチケットを使ってサービスにアクセスします。

AS-REP（Authentication Service Response）は、クライアントが認証を求めた際に、認証サーバー（KDC）が送るレスポンスの一部です。このレスポンスは通常、サーバー側のパスワードのハッシュを含んでいます。

AS-REP Roasting の仕組み:

AS-REP Roastingでは、攻撃者がKerberos認証を要求するユーザーやサービスの認証要求（AS-REQ）を送信し、AS-REPレスポンスを受け取ります。このレスポンスには、ユーザーの暗号化された認証情報（通常はパスワードのハッシュ）が含まれています。

AS-REPは、ターゲットのユーザーが「Pre-Authenticated」（事前認証を必要としない設定）でない限り、暗号化されたデータが含まれます。このため、事前認証が必要ない場合、攻撃者はこれらのレスポンスをオフラインで解析することができ、パスワードのハッシュを解読することが可能です。

攻撃の目的:

攻撃者は、AS-REPレスポンスに含まれる暗号化されたパスワードハッシュを解析することで、ターゲットのユーザーのパスワードを特定できます。このプロセスはオフラインで行えるため、認証サーバーに負荷をかけずに攻撃が可能です。

典型的な流れ

攻撃者がActive Directory環境内でPre-Authenticationが無効化されている（または事前認証が必要ない）ターゲットアカウントを特定します。

攻撃者がそのアカウントに対してAS-REQリクエストを送信します。

AS-REPレスポンスが返され、暗号化されたパスワードハッシュが含まれています。

攻撃者は、オフラインでハッシュを解読し、ユーザーのパスワードを取得します。

AS-REP Roastingに対する防御策

事前認証の強制：

Active Directoryで、すべてのアカウントに対して**事前認証（Pre-Authentication）**を強制する設定を行うことが重要です。これにより、AS-REPレスポンスに暗号化されたパスワードハッシュが含まれなくなり、攻撃が無効化されます。

パスワードポリシーの強化：

強力なパスワードを使用し、可能であればパスワードのリセットを定期的に行うことが有効です。

監視とアラートの設定：

AS-REP Roastingの兆候を監視し、認証に失敗したリクエストや不審なアクティビティに対するアラートを設定することも重要です。

まとめ

AS-REP Roastingは、Active Directory環境において、Pre-Authenticationが無効なアカウントをターゲットにして、暗号化されたパスワードハッシュを取得し、オフラインで解読する攻撃手法です。この攻撃は、パスワードの漏洩や不正アクセスのリスクを高めるため、事前認証の強制やセキュリティ設定の見直しが必要です。